name: Check for QA Merge

on:
  pull_request:
    branches: [ main, master ]

jobs:
  check-qa:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      
      - name: Get SHAs
        id: get_shas
        run: |
          #checkout branch
          git checkout ${{ GITHUB_REF##*/ }}
          #get its head sha
          echo "::set-output name=branch-sha::$(git rev-parse HEAD)"
          #get last common sha between QA and current branch
          echo "::set-output name=last-common-sha::$(git merge-base HEAD QA)"

      - name: Compare SHAs
        run: |
          echo "${{ GITHUB_REF##*/ }} HEAD SHA: ${{ steps.get_shas.output.branch-sha }}"
          echo "Last Common SHA with QA: ${{ steps.get_shas.output.last-common-sha }}"
          if [ ${{steps.get_shas.output.last-common-sha}} != ${{ steps.get_shas.output.branch-sha }} ]
          then
            exit 1
          else
            exit 0
          fi

       
